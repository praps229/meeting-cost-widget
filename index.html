<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Möteskostnad</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Neutral palette that blends into white/grey admin UIs */
      --bg: transparent;
      --card: #ffffff;
      --card2: #fbfbfc;
      --border: rgba(20, 20, 24, 0.12);
      --text: rgba(20, 20, 24, 0.92);
      --muted: rgba(20, 20, 24, 0.62);
      --shadow: 0 10px 22px rgba(16, 24, 40, 0.08);

      --accent: #3b82f6;   /* calm blue */
      --accent2: #111827;  /* near-black */
      --danger: #b91c1c;

      --radius: 16px;
    }

    * { box-sizing: border-box; }

    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
    }

    /* Fixed embed height */
    .widget {
      height: 500px;
      width: 100%;
      padding: 14px;
    }

    .card {
      height: 100%;
      width: 100%;
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(20, 20, 24, 0.08);
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(8px);
    }

    .title {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .title h1 {
      margin: 0;
      font-size: 14px;
      font-weight: 800;
      letter-spacing: -0.01em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .title .sub {
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(20, 20, 24, 0.14);
      background: #fff;
      color: var(--accent2);
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
      user-select: none;
    }

    .chev {
      width: 10px;
      height: 10px;
      border-right: 2px solid rgba(20, 20, 24, 0.65);
      border-bottom: 2px solid rgba(20, 20, 24, 0.65);
      transform: rotate(45deg);
      transition: transform 0.18s ease;
      margin-top: -2px;
    }
    .toggle[aria-expanded="true"] .chev {
      transform: rotate(225deg);
      margin-top: 2px;
    }

    .content {
      display: grid;
      grid-template-columns: 1fr;
      height: 100%;
      min-height: 0;
    }

    /* Counter area */
    .counter {
      padding: 18px 16px 10px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
      min-height: 0;
      gap: 10px;
    }

    .big {
      font-size: 56px;
      line-height: 1.05;
      font-weight: 800;
      letter-spacing: -0.04em;
      margin: 0;
      word-break: break-word;
      font-variant-numeric: tabular-nums;
    }

    .minirow {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      color: var(--muted);
      font-size: 12px;
    }

    .pill {
      border: 1px solid rgba(20, 20, 24, 0.10);
      background: rgba(20, 20, 24, 0.03);
      border-radius: 999px;
      padding: 6px 10px;
      font-variant-numeric: tabular-nums;
    }

    .buttons {
      display: flex;
      gap: 10px;
      padding: 0 16px 16px;
      flex-wrap: wrap;
    }

    button {
      border: 0;
      border-radius: 12px;
      padding: 12px 14px;
      font-weight: 800;
      font-size: 14px;
      cursor: pointer;
      transition: transform 0.04s ease, opacity 0.2s ease;
    }
    button:active { transform: translateY(1px); }
    button[disabled] { opacity: 0.5; cursor: not-allowed; }

    .btn-start {
      background: var(--accent);
      color: #fff;
      flex: 1;
      min-width: 180px;
    }

    .btn-pause {
      background: rgba(20, 20, 24, 0.06);
      border: 1px solid rgba(20, 20, 24, 0.12);
      color: var(--accent2);
      min-width: 120px;
    }

    .btn-reset {
      background: rgba(185, 28, 28, 0.07);
      border: 1px solid rgba(185, 28, 28, 0.20);
      color: var(--danger);
      min-width: 120px;
    }

    /* Collapsible settings */
    .settings {
      border-top: 1px solid rgba(20, 20, 24, 0.08);
      background: #fff;
      overflow: hidden;
      transition: max-height 0.22s ease;
    }

    .settings-inner {
      padding: 14px 16px 16px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    @media (max-width: 520px){
      .big { font-size: 44px; }
      .settings-inner { grid-template-columns: 1fr; }
    }

    label {
      display: block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    input, select {
      width: 100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid rgba(20, 20, 24, 0.14);
      background: #fff;
      color: var(--text);
      outline: none;
      font-size: 14px;
    }

    input:focus, select:focus{
      border-color: rgba(59, 130, 246, 0.55);
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.12);
    }

    .full { grid-column: 1 / -1; }

    .hint {
      margin-top: 6px;
      font-size: 11px;
      color: rgba(20, 20, 24, 0.55);
      line-height: 1.35;
    }
  </style>
</head>

<body>
  <div class="widget">
    <div class="card">
      <div class="topbar">
        <div class="title">
          <h1>Möteskostnad</h1>
          <div class="sub">Kostnaden tickar var 15:e sekund efter start</div>
        </div>

        <div id="settingsToggle" class="toggle" role="button" tabindex="0" aria-expanded="true" aria-controls="settingsPanel">
          Inställningar <span class="chev" aria-hidden="true"></span>
        </div>
      </div>

      <div class="content">
        <div class="counter">
          <div style="font-size:12px;color:var(--muted);">Kostnad hittills</div>
          <p id="cost" class="big">0 kr</p>

          <div class="minirow" aria-label="Minimal meeting info">
            <span class="pill">Tid: <span id="elapsed">00:00:00</span></span>
            <span class="pill"><span id="peopleOut">8</span> personer</span>
          </div>
        </div>

        <div class="buttons">
          <button id="startBtn" class="btn-start">Starta</button>
          <button id="pauseBtn" class="btn-pause" disabled>Pausa</button>
          <button id="resetBtn" class="btn-reset" disabled>Nollställ</button>
        </div>

        <div id="settingsPanel" class="settings">
          <div class="settings-inner">
            <div>
              <label for="people">Antal personer</label>
              <input id="people" type="number" min="1" step="1" value="8" />
            </div>

            <div>
              <label for="currency">Valuta</label>
              <select id="currency">
                <option value="SEK" selected>SEK (kr)</option>
                <option value="EUR">EUR (€)</option>
                <option value="GBP">GBP (£)</option>
                <option value="USD">USD ($)</option>
              </select>
              <div class="hint">Formateras med svensk sifferstil (tusentalsmellanrum).</div>
            </div>

            <div class="full">
              <label for="defaultCph">Standardkostnad per person och timme</label>
              <input id="defaultCph" type="number" min="0" step="1" value="650" />
              <div class="hint">Sätt ett rimligt “påslag” här (lön + LKP, ev overhead) så blir det konsekvent.</div>
            </div>

            <div class="full">
              <label for="cph">Tillfällig override (valfritt)</label>
              <input id="cph" type="number" min="0" step="1" placeholder="Lämna tomt för att använda standard" />
              <div class="hint">Om du fyller i här används den siffran istället för standardkostnaden.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // Behaviour
  const COST_TICK_SECONDS = 15; // requested
  const TIME_TICK_SECONDS = 1;  // keep time smooth

  // Elements
  const elCost = document.getElementById("cost");
  const elElapsed = document.getElementById("elapsed");
  const elPeopleOut = document.getElementById("peopleOut");

  const inpPeople = document.getElementById("people");
  const inpCurrency = document.getElementById("currency");
  const inpCph = document.getElementById("cph");
  const inpDefaultCph = document.getElementById("defaultCph");

  const btnStart = document.getElementById("startBtn");
  const btnPause = document.getElementById("pauseBtn");
  const btnReset = document.getElementById("resetBtn");

  const toggle = document.getElementById("settingsToggle");
  const panel = document.getElementById("settingsPanel");

  // State
  let running = false;
  let startedAt = null;   // ms
  let pausedAt = null;    // ms
  let totalPausedMs = 0;

  let timeInterval = null;
  let costInterval = null;

  function safeNumber(value, fallback){
    const n = Number(value);
    return Number.isFinite(n) ? n : fallback;
  }

  function getPeople(){
    const p = safeNumber(inpPeople.value, 1);
    return Math.max(1, Math.floor(p));
  }

  function getCurrency(){
    return inpCurrency.value || "SEK";
  }

  function getCostPerPersonPerHour(){
    const override = (inpCph.value || "").trim();
    if (override !== ""){
      return Math.max(0, safeNumber(override, 0));
    }
    return Math.max(0, safeNumber(inpDefaultCph.value, 0));
  }

  function moneyFormatter(currency){
    // Swedish style: space as thousands separator, comma decimals (we show 0 decimals)
    // SEK gets "kr" in Swedish locale formatting.
    try{
      return new Intl.NumberFormat("sv-SE", {
        style: "currency",
        currency,
        maximumFractionDigits: 0
      });
    } catch {
      // Fallback
      return new Intl.NumberFormat("sv-SE", { maximumFractionDigits: 0 });
    }
  }

  function pad2(n){ return String(n).padStart(2, "0"); }

  function formatElapsed(ms){
    const total = Math.max(0, Math.floor(ms / 1000));
    const h = Math.floor(total / 3600);
    const m = Math.floor((total % 3600) / 60);
    const s = total % 60;
    return `${pad2(h)}:${pad2(m)}:${pad2(s)}`;
  }

  function effectiveElapsedMs(nowMs){
    if (!startedAt) return 0;
    return Math.max(0, nowMs - startedAt - totalPausedMs);
  }

  function computeCost(nowMs){
    // Make the cost "tick" in discrete 15-second steps after start.
    const stepMs = COST_TICK_SECONDS * 1000;
    const elapsed = effectiveElapsedMs(nowMs);
    const quantisedMs = Math.floor(elapsed / stepMs) * stepMs;

    const people = getPeople();
    const cph = getCostPerPersonPerHour();
    const hours = quantisedMs / (1000 * 60 * 60);

    return people * cph * hours;
  }

  function render(){
    const now = Date.now();
    const people = getPeople();
    const currency = getCurrency();
    const fmt = moneyFormatter(currency);

    elPeopleOut.textContent = people;
    elElapsed.textContent = formatElapsed(effectiveElapsedMs(now));

    const cost = computeCost(now);

    // Some currencies (SEK) get nice formatting with "kr" in sv-SE
    // If Intl fails, it will still produce Swedish grouping for numbers.
    let out;
    try{
      out = fmt.format(cost);
    } catch {
      out = `${new Intl.NumberFormat("sv-SE", { maximumFractionDigits: 0 }).format(cost)} ${currency}`;
    }
    elCost.textContent = out;
  }

  function setUiState(){
    btnStart.disabled = running;
    btnPause.disabled = !running;
    btnReset.disabled = !startedAt;

    // Allow changing settings only when not running (reduces confusion)
    inpPeople.disabled = running;
    inpCurrency.disabled = running;
    inpCph.disabled = running;
    inpDefaultCph.disabled = running;
  }

  function start(){
    if (running) return;
    const now = Date.now();

    if (!startedAt){
      startedAt = now;
      totalPausedMs = 0;
    } else if (pausedAt){
      totalPausedMs += (now - pausedAt);
    }

    pausedAt = null;
    running = true;

    timeInterval = setInterval(render, TIME_TICK_SECONDS * 1000);
    costInterval = setInterval(render, COST_TICK_SECONDS * 1000);

    render();
    setUiState();
  }

  function pause(){
    if (!running) return;
    running = false;
    pausedAt = Date.now();

    clearInterval(timeInterval);
    clearInterval(costInterval);
    timeInterval = null;
    costInterval = null;

    render();
    setUiState();
  }

  function reset(){
    running = false;
    startedAt = null;
    pausedAt = null;
    totalPausedMs = 0;

    clearInterval(timeInterval);
    clearInterval(costInterval);
    timeInterval = null;
    costInterval = null;

    render();
    setUiState();
  }

  // Collapsible settings (open by default)
  function setPanel(open){
    toggle.setAttribute("aria-expanded", open ? "true" : "false");
    if (open){
      // Set to the content height for smooth animation
      panel.style.maxHeight = panel.scrollHeight + "px";
    } else {
      panel.style.maxHeight = "0px";
    }
  }

  function togglePanel(){
    const isOpen = toggle.getAttribute("aria-expanded") === "true";
    setPanel(!isOpen);
  }

  toggle.addEventListener("click", togglePanel);
  toggle.addEventListener("keydown", (e) => {
    if (e.key === "Enter" || e.key === " ") {
      e.preventDefault();
      togglePanel();
    }
  });

  // Wire up buttons
  btnStart.addEventListener("click", start);
  btnPause.addEventListener("click", pause);
  btnReset.addEventListener("click", reset);

  // Live update when not running
  ["input", "change"].forEach(evt => {
    [inpPeople, inpCurrency, inpCph, inpDefaultCph].forEach(el => {
      el.addEventListener(evt, () => { if (!running) render(); });
    });
  });

  // Initial layout + render
  render();
  setUiState();

  // Ensure panel height is correct after fonts load/layout settles
  window.addEventListener("load", () => setPanel(true));
  window.addEventListener("resize", () => {
    const isOpen = toggle.getAttribute("aria-expanded") === "true";
    if (isOpen) setPanel(true);
  });
</script>
</body>
</html>
