<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Möteskostnad</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    /* Prevent layout jump when scrollbars appear (even in embeds) */

    :root{
      --page-bg:#fff;
      --card:#fff;
      --card2:#fbfbfc;
      --border:rgba(17,24,39,.14);
      --border-soft:rgba(17,24,39,.10);
      --text:rgba(17,24,39,.92);
      --muted:rgba(17,24,39,.62);
      --accent:#2563eb;
      --accent-hover:#1d4ed8;
      --danger:#b91c1c;
    }

    *{ box-sizing:border-box; }

    html,body{
      height:100%;
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:var(--page-bg);
    }

    /* Autofit: no fixed height */
    .widget{
      width:100%;
      padding:0;
      background:transparent;
    }

    .card{
      width:100%;
      background: #fff;
      display:flex;
      flex-direction:column;
      overflow:visible;
    }

    /* Keep divider under header */
    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:14px 16px;
      border-bottom:1px solid rgba(0,0,0,.08);
      background:#fff;
      gap:12px;
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }

    .title h1{
      margin:0;
      font-size:14px;
      font-weight:800;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .title .sub{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .controls{
      display:flex;
      gap:8px;
      align-items:center;
    }

    .lang-toggle,.settings-toggle{
      font-size:12px;
      font-weight:800;
      padding:8px 10px;
      border:1px solid var(--border);
      background:#fff;
      cursor:pointer;
    }

    .main{
      text-align:center;
      padding:24px 16px 8px;
      background:transparent;
    }

    .label{
      font-size:12px;
      color:var(--muted);
    }

    .big{
      font-size:56px;
      font-weight:800;
      margin:8px 0 4px;
      font-variant-numeric:tabular-nums;
    }

    .meta{
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top:6px;
      font-size:12px;
      color:var(--muted);
    }

    .pill{
      padding:6px 10px;
      border:1px solid var(--border-soft);
      background:rgba(0,0,0,.03);
      font-variant-numeric:tabular-nums;
    }

    .people{
      margin-top:16px;
      display:flex;
      justify-content:center;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    .stepper{
      display:inline-flex;
      border:1px solid var(--border);
      overflow:hidden;
      background:#fff;
    }

    .stepper button{
      width:36px;
      height:34px;
      border:none;
      background:rgba(0,0,0,.05);
      font-weight:800;
      cursor:pointer;
    }

    .stepper button:active{ transform: translateY(1px); }
    .stepper button[disabled]{ opacity:.45; cursor:not-allowed; }

    .stepper input{
      width:64px;
      height:34px;
      border:none;
      text-align:center;
      font-size:14px;
      outline:none;
      font-variant-numeric:tabular-nums;
      background:#fff;
    }

    /* Remove native number spinners */
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{
      -webkit-appearance:none;
      margin:0;
    }
    input[type="number"]{ -moz-appearance:textfield; }

    .buttons{
      padding:8px 16px 16px;
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
    }

    .btn{
      padding:12px 14px;
      border:none;
      font-weight:800;
      cursor:pointer;
      min-width:120px;
      transition: background .15s ease, opacity .2s ease;
    }
    .btn[disabled]{ opacity:.45; cursor:not-allowed; }

    .btn-start{ background:var(--accent); color:#fff; min-width:160px; }
    .btn-start:hover{ background:var(--accent-hover); }
    .btn-pause{ background:#eee; }
    .btn-reset{ background:#fdecec; color:var(--danger); }

    /* Keep divider above settings */
    .settings{
      border-top:1px solid rgba(0,0,0,.08);
      background:#fff;
      overflow:hidden;
      max-height:0;
      transition:max-height .25s ease;
    }

    .settings-inner{
  padding:14px 16px 16px;
  display:grid;
  gap:12px;
  grid-template-columns:auto auto;
  justify-content:center;
}

    @media (max-width:560px){
      .big{ font-size:44px; }
      .settings-inner{ grid-template-columns:1fr; }
      .btn-start{ min-width:100%; }
    }

    label{
      font-size:12px;
      color:var(--muted);
      display:block;
      margin-bottom:6px;
      text-align:left;
    }

    select,input.setting{
      width:100%;
      padding:10px;
      border:1px solid var(--border);
      font-size:14px;
      background:#fff;
    }

    /* Remove all rounded corners everywhere */
    *{ border-radius:0 !important; }

    /* Limit width of settings controls */
.settings-inner select,
.settings-inner input.setting{
  width: 200px;
  max-width: 100%;
}
    
  </style>
</head>

<body>
<div class="widget">
  <div class="card">

    <div class="topbar">
      <div class="title">
        <h1 id="t_title"></h1>
        <div class="sub" id="t_sub"></div>
      </div>

      <div class="controls">
        <button id="langBtn" class="lang-toggle" type="button">EN</button>
        <button id="settingsBtn" class="settings-toggle" type="button"></button>
      </div>
    </div>

    <div class="main">
      <div class="label" id="t_cost_label"></div>
      <div id="cost" class="big">0 kr</div>

      <div class="meta">
        <span class="pill"><span id="t_time_label"></span> <span id="elapsed">00:00:00</span></span>
      </div>

      <div class="people">
        <span id="t_people"></span>
        <div class="stepper" role="group" aria-label="People stepper">
          <button id="minus" type="button" aria-label="Minus">−</button>
          <input id="people" type="number" value="4" min="1" inputmode="numeric" aria-label="People">
          <button id="plus" type="button" aria-label="Plus">+</button>
        </div>
      </div>
    </div>

    <div class="buttons">
      <button id="start" class="btn btn-start" type="button"></button>
      <button id="pause" class="btn btn-pause" type="button" disabled></button>
      <button id="reset" class="btn btn-reset" type="button" disabled></button>
    </div>

    <div id="settings" class="settings">
      <div class="settings-inner">
        <div>
          <label id="t_currency" for="currency"></label>
          <select id="currency" class="setting">
            <option value="SEK" selected>SEK</option>
            <option value="EUR">EUR</option>
            <option value="GBP">GBP</option>
            <option value="USD">USD</option>
          </select>
        </div>
        <div>
          <label id="t_costph" for="cph"></label>
          <input id="cph" class="setting" type="number" value="650" min="0" step="1">
        </div>
      </div>
    </div>

  </div>
</div>

<script>
  const COST_TICK_SECONDS = 3;
  const TIME_TICK_SECONDS = 1;

  const TEXT = {
    sv: {
      title: "Möteskostnad",
     // sub: "Kostnaden ökar var 3:e sekund",
      costLabel: "Kostnad hittills",
      timeLabel: "Tid:",
      people: "Antal personer",
      start: "Starta",
      pause: "Pausa",
      reset: "Nollställ",
      settings: "Inställningar",
      currency: "Valuta",
      costph: "Kostnad per person och timme"
    },
    en: {
      title: "Meeting cost",
    // sub: "Cost increases every 3 seconds",
      costLabel: "Cost so far",
      timeLabel: "Time:",
      people: "Number of people",
      start: "Start",
      pause: "Pause",
      reset: "Reset",
      settings: "Settings",
      currency: "Currency",
      costph: "Cost per person per hour"
    }
  };

  let lang = "sv";

  const $ = (id) => document.getElementById(id);

  const elCost = $("cost");
  const elElapsed = $("elapsed");

  const inpPeople = $("people");
  const inpCurrency = $("currency");
  const inpCph = $("cph");

  const btnMinus = $("minus");
  const btnPlus = $("plus");

  const btnStart = $("start");
  const btnPause = $("pause");
  const btnReset = $("reset");

  const settingsBtn = $("settingsBtn");
  const settingsPanel = $("settings");

  let running = false;
  let startedAt = null;
  let pausedAt = null;
  let totalPausedMs = 0;

  let timeInterval = null;
  let costInterval = null;

  function applyText(){
    const t = TEXT[lang];
    $("t_title").textContent = t.title;
    $("t_sub").textContent = t.sub;
    $("t_cost_label").textContent = t.costLabel;
    $("t_time_label").textContent = t.timeLabel;
    $("t_people").textContent = t.people;
    btnStart.textContent = t.start;
    btnPause.textContent = t.pause;
    btnReset.textContent = t.reset;
    settingsBtn.textContent = t.settings;
    $("t_currency").textContent = t.currency;
    $("t_costph").textContent = t.costph;
  }

  function safeNumber(v, fallback){
    const n = Number(v);
    return Number.isFinite(n) ? n : fallback;
  }

  function clampPeople(n){
    n = Math.floor(safeNumber(n, 1));
    return Math.max(1, n);
  }

  function setPeople(n){
    inpPeople.value = String(clampPeople(n));
    render();
  }

  function getPeople(){
    return clampPeople(inpPeople.value);
  }

  function getCurrency(){
    return inpCurrency.value || "SEK";
  }

  function getCostPerPersonPerHour(){
    return Math.max(0, safeNumber(inpCph.value, 0));
  }

  function pad2(n){ return String(n).padStart(2, "0"); }

  function formatElapsed(ms){
    const total = Math.max(0, Math.floor(ms / 1000));
    const h = Math.floor(total / 3600);
    const m = Math.floor((total % 3600) / 60);
    const s = total % 60;
    return `${pad2(h)}:${pad2(m)}:${pad2(s)}`;
  }

  function effectiveElapsedMs(nowMs){
    if (!startedAt) return 0;
    return Math.max(0, nowMs - startedAt - totalPausedMs);
  }

  function computeCost(nowMs){
    const stepMs = COST_TICK_SECONDS * 1000;
    const elapsed = effectiveElapsedMs(nowMs);
    const quantisedMs = Math.floor(elapsed / stepMs) * stepMs;

    const people = getPeople();
    const cph = getCostPerPersonPerHour();
    const hours = quantisedMs / (1000 * 60 * 60);

    return people * cph * hours;
  }

  function formatMoney(amount, currency){
    try{
      return new Intl.NumberFormat("sv-SE", {
        style: "currency",
        currency,
        maximumFractionDigits: 0
      }).format(amount);
    } catch {
      return `${new Intl.NumberFormat("sv-SE", { maximumFractionDigits: 0 }).format(amount)} ${currency}`;
    }
  }

  function render(){
    const now = Date.now();
    elElapsed.textContent = formatElapsed(effectiveElapsedMs(now));
    elCost.textContent = formatMoney(computeCost(now), getCurrency());
  }

  function setUiState(){
    btnStart.disabled = running;
    btnPause.disabled = !running;
    btnReset.disabled = !startedAt;

    // Lock people while running
    inpPeople.disabled = running;
    btnMinus.disabled = running;
    btnPlus.disabled = running;

    // Lock cost settings while running
    inpCurrency.disabled = running;
    inpCph.disabled = running;
  }

  function start(){
    if (running) return;

    const now = Date.now();
    if (!startedAt){
      startedAt = now;
      totalPausedMs = 0;
    } else if (pausedAt){
      totalPausedMs += (now - pausedAt);
    }

    pausedAt = null;
    running = true;

    timeInterval = setInterval(render, TIME_TICK_SECONDS * 1000);
    costInterval = setInterval(render, COST_TICK_SECONDS * 1000);

    render();
    setUiState();
  }

  function pause(){
    if (!running) return;

    running = false;
    pausedAt = Date.now();

    clearInterval(timeInterval);
    clearInterval(costInterval);
    timeInterval = null;
    costInterval = null;

    render();
    setUiState();
  }

  function reset(){
    running = false;
    startedAt = null;
    pausedAt = null;
    totalPausedMs = 0;

    clearInterval(timeInterval);
    clearInterval(costInterval);
    timeInterval = null;
    costInterval = null;

    render();
    setUiState();
  }

  function toggleSettings(){
    const open = settingsPanel.style.maxHeight && settingsPanel.style.maxHeight !== "0px";
    settingsPanel.style.maxHeight = open ? null : settingsPanel.scrollHeight + "px";
  }

  $("langBtn").addEventListener("click", () => {
    lang = (lang === "sv") ? "en" : "sv";
    $("langBtn").textContent = (lang === "sv") ? "EN" : "SV";
    applyText();
  });

  settingsBtn.addEventListener("click", toggleSettings);

  window.addEventListener("resize", () => {
    const open = settingsPanel.style.maxHeight && settingsPanel.style.maxHeight !== "0px";
    if (open) settingsPanel.style.maxHeight = settingsPanel.scrollHeight + "px";
  });

  btnMinus.addEventListener("click", () => setPeople(getPeople() - 1));
  btnPlus.addEventListener("click", () => setPeople(getPeople() + 1));
  inpPeople.addEventListener("blur", () => setPeople(inpPeople.value));

  btnStart.addEventListener("click", start);
  btnPause.addEventListener("click", pause);
  btnReset.addEventListener("click", reset);

  ["input", "change"].forEach(evt => {
    [inpCurrency, inpCph].forEach(el => el.addEventListener(evt, () => { if (!running) render(); }));
  });

  applyText();
  render();
  setUiState();
</script>
</body>
</html>
